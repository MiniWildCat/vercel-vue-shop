(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-26d752f6"],{"0c19":function(e,t,s){},"723a":function(e,t,s){"use strict";s("0c19")},7722:function(e,t,s){},"847c":function(e,t,s){},"84a9":function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return o})),s.d(t,"e",(function(){return r})),s.d(t,"g",(function(){return d})),s.d(t,"f",(function(){return n})),s.d(t,"a",(function(){return c})),s.d(t,"d",(function(){return l})),s.d(t,"h",(function(){return u}));var i=s("ff66");function a(e){return Object(i["d"])({url:"/buyer/store/store/apply/first",needToken:!0,method:i["a"].PUT,params:e})}function o(e){return Object(i["d"])({url:"/buyer/store/store/apply/second",needToken:!0,method:i["a"].PUT,params:e})}function r(e){return Object(i["d"])({url:"/buyer/store/store/apply/third",needToken:!0,method:i["a"].PUT,params:e})}function d(e){return Object(i["d"])({url:"/buyer/store/store/get/detail/"+e,needToken:!0,method:i["a"].GET})}function n(e){return Object(i["d"])({url:"/buyer/store/store/label/get/"+e,needToken:!0,method:i["a"].GET})}function c(){return Object(i["d"])({url:"/buyer/other/article/type/STORE_REGISTER",needToken:!0,method:i["a"].GET})}function l(){return Object(i["d"])({url:"/buyer/store/store/apply",needToken:!0,method:i["a"].GET})}function u(e,t){return Object(i["d"])({url:"/buyer/store/address/page/"+e,method:i["a"].GET,params:t})}},"99cd":function(e,t,s){"use strict";s("7722")},aff4:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pay-order"},[t("BaseHeader"),t("div",{staticClass:"width_1200 logo"},[t("div",[t("router-link",{attrs:{to:"/"}},[t("img",{attrs:{src:e.$store.state.logoImg}})]),t("div",[e._v("结算页")])],1),t("div",{staticClass:"cart-steps"},[t("span",{class:1==e.stepIndex?"active":""},[e._v("1.我的购物车")]),t("Icon",{class:1==e.stepIndex?"active-arrow":"",attrs:{custom:"icomoon icon-next"}}),t("span",{class:1==e.stepIndex?"active":""},[e._v("2.填写订单信息")]),t("Icon",{class:1==e.stepIndex?"active-arrow":"",attrs:{custom:"icomoon icon-next"}}),t("span",{class:2==e.stepIndex?"active":""},[e._v("3.成功提交订单")])],1)]),t("Divider"),t("div",{staticClass:"content width_1200"},["LOGISTICS"===e.selectedDeliverMethod&&"VIRTUAL_GOODS"!==e.goodsType?t("div",{staticClass:"address"},[t("div",{staticClass:"card-head"},[t("span",[e._v("收货人信息")]),t("span",{on:{click:e.goAddressManage}},[e._v("管理收货人地址")])]),t("div",{staticClass:"address-manage"},[e._l(e.addressList,(function(s,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.moreAddr||i<3,expression:"moreAddr ? true : index < 3"}],key:i,staticClass:"address-item",class:e.selectedAddress.id===s.id?"border-red":"",on:{mouseenter:function(t){e.showEditBtn=i},mouseleave:function(t){e.showEditBtn=""},click:function(t){return e.selectAddress(s)}}},[t("div",[t("span",[e._v(e._s(s.name))]),s.isDefault?t("Tag",{staticClass:"ml_10",attrs:{color:"red"}},[e._v("默认")]):e._e(),s.alias?t("Tag",{staticClass:"ml_10",attrs:{color:"warning"}},[e._v(e._s(s.alias)+" ")]):e._e()],1),t("div",[e._v(e._s(s.mobile))]),t("div",[e._v(" "+e._s(e._f("unitAddress")(s.consigneeAddressPath))+" "+e._s(s.detail)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showEditBtn===i,expression:"showEditBtn === index"}],staticClass:"edit-btn"},[t("span",{on:{click:function(t){return t.stopPropagation(),e.editAddress(s.id)}}},[e._v("修改")]),s.isDefault?e._e():t("span",{staticClass:"ml_10",on:{click:function(t){return t.stopPropagation(),e.delAddress(s)}}},[e._v("删除")])]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedAddress.id===s.id,expression:"selectedAddress.id === item.id"}],staticClass:"corner-icon"},[t("div"),t("Icon",{attrs:{type:"md-checkmark"}})],1)])})),t("div",{staticClass:"add-address",on:{click:function(t){return e.editAddress("")}}},[t("Icon",{attrs:{type:"ios-add-circle-outline"}}),t("div",[e._v("添加新地址")])],1)],2),e.addressList.length>3?t("div",{staticClass:"more-addr",on:{click:function(t){e.moreAddr=!e.moreAddr}}},[e._v(" "+e._s(e.moreAddr?"收起地址":"更多地址")+" "),t("Icon",{directives:[{name:"show",rawName:"v-show",value:!e.moreAddr,expression:"!moreAddr"}],attrs:{type:"md-arrow-dropdown"}}),t("Icon",{directives:[{name:"show",rawName:"v-show",value:e.moreAddr,expression:"moreAddr"}],attrs:{type:"md-arrow-dropup"}})],1):e._e()]):e._e(),"SELF_PICK_UP"===e.selectedDeliverMethod?t("div",{staticClass:"address"},[e._m(0),t("div",{staticClass:"address-manage"},e._l(e.storeAddressList,(function(s,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.storeMoreAddr||i<3,expression:"storeMoreAddr ? true : index < 3"}],key:i,staticClass:"address-item",class:e.selectedAddress.id===s.id?"border-red":"",on:{mouseenter:function(t){e.showEditBtn=i},mouseleave:function(t){e.showEditBtn=""},click:function(t){return e.selectStoreAddress(s)}}},[t("div",[t("span",[e._v(e._s(s.addressName))])]),t("div",[e._v(e._s(s.mobile))]),t("div",[e._v(" "+e._s(e._f("unitAddress")(s.address))+" "+e._s(s.detail)+" ")]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedStoreAddress.id===s.id,expression:"selectedStoreAddress.id === item.id"}],staticClass:"corner-icon"},[t("div"),t("Icon",{attrs:{type:"md-checkmark"}})],1)])})),0),e.addressList.length>3?t("div",{staticClass:"more-addr",on:{click:function(t){e.storeMoreAddr=!e.storeMoreAddr}}},[e._v(" "+e._s(e.storeMoreAddr?"收起地址":"更多地址")+" "),t("Icon",{directives:[{name:"show",rawName:"v-show",value:!e.storeMoreAddr,expression:"!storeMoreAddr"}],attrs:{type:"md-arrow-dropdown"}}),t("Icon",{directives:[{name:"show",rawName:"v-show",value:e.storeMoreAddr,expression:"storeMoreAddr"}],attrs:{type:"md-arrow-dropup"}})],1):e._e()]):e._e(),t("div"),"VIRTUAL_GOODS"!==e.goodsType?t("div",{staticClass:"goods-content"},[e._m(1),t("div",{staticClass:"delivery-method"},e._l(e.shippingMethod,(function(s,i){return t("div",{directives:[{name:"show",rawName:"v-show",value:!!e.moreAddr||i<3,expression:"moreAddr ? true : index < 3"}],key:i,staticClass:"method-item",class:e.selectedDeliverMethod===s.value?"border-red":"",on:{mouseenter:function(t){e.showEditBtn=s.value},mouseleave:function(t){e.showEditBtn=""},click:function(t){return e.selectDeliverMethod(s)}}},[t("div",[e._v(e._s(s.label))]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.selectedDeliverMethod===s.value,expression:"selectedDeliverMethod === item.value"}],staticClass:"corner-icon"},[t("div"),t("Icon",{attrs:{type:"md-checkmark"}})],1)])})),0)]):e._e(),t("div",{staticClass:"goods-content"},[t("div",{staticClass:"card-head mt_20 mb_20"},[t("span",[e._v("商品信息")]),t("span",{on:{click:function(t){return e.$router.push("/cart")}}},[e._v("返回购物车")])]),e._l(e.goodsList,(function(s,i){return t("div",{key:i,staticClass:"goods-msg"},[s.checked?t("div",[t("div",{staticClass:"shop-name"},[t("span",[t("span",{staticClass:"hover-color",on:{click:function(t){return e.goShopPage(s.storeId)}}},[e._v(e._s(s.storeName))]),e._v("   ")])]),t("div",{staticClass:"goods-list"},e._l(s.checkedSkuList,(function(s,i){return t("div",{key:i,staticClass:"goods-item"},[t("span",{staticClass:"hover-color",on:{click:function(t){return e.goGoodsDetail(s.goodsSku.id,s.goodsSku.goodsId)}}},[t("img",{attrs:{src:s.goodsSku.thumbnail,alt:""}}),t("span",{staticStyle:{"vertical-align":"top"}},[e._v(e._s(s.goodsSku.goodsName))])]),t("span",{staticClass:"goods-price"},[e._v(e._s(e._f("unitPrice")(s.purchasePrice,"￥")))]),t("span",[e._v("x"+e._s(s.num))]),t("span",[e._v(e._s(s.goodsSku.quantity>0?"有货":"无货"))]),t("span",{staticClass:"goods-price"},[e._v(e._s(e._f("unitPrice")(s.subTotal,"￥")))])])})),0),t("div",{staticClass:"order-mark"},[t("Input",{attrs:{type:"textarea",maxlength:"60","show-word-limit":"",placeholder:"订单备注"},model:{value:s.remark,callback:function(t){e.$set(s,"remark",t)},expression:"shop.remark"}}),t("span",{staticStyle:{"font-size":"12px",color:"#999"}},[e._v("提示：请勿填写有关支付、收货、发票方面的信息")])],1)]):e._e()])}))],2),t("div",{staticClass:"invoice"},[t("div",{staticClass:"card-head mt_20 mb_20"},[t("span",{staticClass:"relative"},[e._v("发票信息"),t("span",{staticClass:"inv-tips"},[t("Icon",{attrs:{type:"ios-alert-outline"}}),e._v("开企业抬头发票须填写纳税人识别号，以免影响报销 ")],1)])]),t("div",{staticClass:"inovice-content"},[t("span",[e._v(e._s(e.invoiceData.receiptTitle))]),t("span",[e._v(e._s(e.invoiceData.receiptContent))]),t("span",{on:{click:e.editInvoice}},[e._v("编辑")])])]),t("div",{staticClass:"invoice"},[e._m(2),0===e.couponList.length?t("div",[e._v("无可用优惠券")]):t("ul",{staticClass:"coupon-list"},e._l(e.couponList,(function(i,a){return t("li",{key:a,staticClass:"coupon-item"},[t("div",{staticClass:"c-left"},[t("div",["PRICE"===i.couponType?t("span",{staticClass:"fontsize_12 global_color"},[e._v("￥"),t("span",{staticClass:"price"},[e._v(e._s(e._f("unitPrice")(i.price)))])]):e._e(),"DISCOUNT"===i.couponType?t("span",{staticClass:"fontsize_12 global_color"},[t("span",{staticClass:"price"},[e._v(e._s(i.discount))]),e._v("折")]):e._e(),t("span",{staticClass:"describe"},[e._v("满"+e._s(i.consumeThreshold)+"元可用")])]),t("p",[e._v("使用范围："+e._s(e.useScope(i.scopeType)))]),t("p",[e._v("有效期："+e._s(i.endTime))])]),e.usedCouponId.includes(i.id)?t("img",{staticClass:"used",attrs:{src:s("e092"),alt:""}}):e._e(),t("b"),t("a",{staticClass:"c-right",on:{click:function(t){return e.useCoupon(i.id,!0)}}},[e._v("立即使用")]),e.usedCouponId.includes(i.id)?t("a",{staticClass:"c-right",on:{click:function(t){return e.useCoupon(i.id,!1)}}},[e._v("放弃优惠")]):e._e(),t("i",{staticClass:"circle-top"}),t("i",{staticClass:"circle-bottom"})])})),0)]),t("div",{staticClass:"order-price"},[t("div",[t("span",[e._v(e._s(e.totalNum)+"件商品，总商品金额：")]),t("span",[e._v(e._s(e._f("unitPrice")(e.priceDetailDTO.goodsPrice,"￥")))])]),e.priceDetailDTO.freightPrice>0?t("div",[t("span",[e._v("运费：")]),t("span",[e._v(e._s(e._f("unitPrice")(e.priceDetailDTO.freightPrice,"￥")))])]):e._e(),e.priceDetailDTO.discountPrice>0?t("div",[t("span",[e._v("优惠金额：")]),t("span",[e._v("-"+e._s(e._f("unitPrice")(e.priceDetailDTO.discountPrice,"￥")))])]):e._e(),e.priceDetailDTO.couponPrice>0?t("div",[t("span",[e._v("优惠券金额：")]),t("span",[e._v("-"+e._s(e._f("unitPrice")(e.priceDetailDTO.couponPrice,"￥")))])]):e._e(),"POINTS"===e.$route.query.way?t("div",[t("span",[e._v("应付积分：")]),t("span",{staticClass:"actrual-price"},[e._v(e._s(e.priceDetailDTO.payPoint))])]):t("div",[t("span",[e._v("应付金额：")]),t("span",{staticClass:"actrual-price"},[e._v(e._s(e._f("unitPrice")(e.priceDetailDTO.flowPrice,"￥")))])])])]),t("div",{staticClass:"order-footer width_1200"},[t("div",{staticClass:"pay ml_20",on:{click:e.pay}},[e._v("提交订单")]),e.addressList.length&&"LOGISTICS"===e.selectedDeliverMethod?t("div",{staticClass:"pay-address"},[e._v(" 配送至："+e._s(e._f("unitAddress")(e.selectedAddress.consigneeAddressPath))+" "+e._s(e.selectedAddress.detail)+"  收货人："+e._s(e.selectedAddress.name)+"  "+e._s(e.selectedAddress.mobile)+" ")]):e._e(),e.addressList.length&&"SELF_PICK_UP"===e.selectedDeliverMethod?t("div",{staticClass:"pay-address"},[e._v(" 自提地点："+e._s(e.selectedStoreAddress.address)+"   联系方式："+e._s(e.selectedStoreAddress.mobile)+" ")]):e._e()]),t("BaseFooter"),t("invoice-modal",{ref:"invModal",attrs:{invoiceData:e.invoiceData},on:{change:e.getInvMsg}}),t("address-manage",{ref:"address",attrs:{id:e.addrId},on:{change:e.addrChange}})],1)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-head"},[t("span",[e._v("自提点信息")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-head mt_20 mb_20"},[t("span",[e._v("配送方式")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-head mt_20 mb_20"},[t("span",{staticClass:"relative"},[e._v("优惠券")])])}],o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"invoice-modal"},[t("Modal",{attrs:{width:"600","footer-hide":""},model:{value:e.invoiceAvailable,callback:function(t){e.invoiceAvailable=t},expression:"invoiceAvailable"}},[t("p",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("发票信息")])]),t("div",{staticClass:"nav-content"},[t("Form",{ref:"form",attrs:{model:e.invoiceForm,"label-position":"left",rules:e.ruleInline,"label-width":110}},[t("FormItem",{attrs:{label:"发票类型"}},[t("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:e.invoice,callback:function(t){e.invoice=t},expression:"invoice"}},[t("Radio",{attrs:{label:1},on:{"on-change":e.changeInvoice}},[e._v("电子普通发票")]),t("Radio",{attrs:{label:2,disabled:!0}},[e._v("增值税专用发票")])],1)],1),t("FormItem",{attrs:{label:"发票抬头"}},[t("RadioGroup",{attrs:{type:"button","button-style":"solid"},on:{"on-change":e.changeInvoice},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[t("Radio",{attrs:{label:1}},[e._v("个人")]),t("Radio",{attrs:{label:2}},[e._v("单位")])],1)],1),1===e.type?t("FormItem",{attrs:{label:"个人名称",prop:"receiptTitle"}},[t("i-input",{model:{value:e.invoiceForm.receiptTitle,callback:function(t){e.$set(e.invoiceForm,"receiptTitle",t)},expression:"invoiceForm.receiptTitle"}})],1):e._e(),2===e.type?t("FormItem",{attrs:{label:"单位名称",prop:"receiptTitle"}},[t("i-input",{model:{value:e.invoiceForm.receiptTitle,callback:function(t){e.$set(e.invoiceForm,"receiptTitle",t)},expression:"invoiceForm.receiptTitle"}})],1):e._e(),2===e.type?t("FormItem",{attrs:{label:"纳税人识别号",prop:"taxpayerId"}},[t("i-input",{model:{value:e.invoiceForm.taxpayerId,callback:function(t){e.$set(e.invoiceForm,"taxpayerId",t)},expression:"invoiceForm.taxpayerId"}})],1):e._e(),t("FormItem",{attrs:{label:"发票内容"}},[t("RadioGroup",{attrs:{type:"button","button-style":"solid"},model:{value:e.invoiceForm.receiptContent,callback:function(t){e.$set(e.invoiceForm,"receiptContent",t)},expression:"invoiceForm.receiptContent"}},[t("Radio",{attrs:{label:"商品明细"}},[e._v("商品明细")]),t("Radio",{attrs:{label:"商品类别"}},[e._v("商品类别")])],1)],1)],1),t("div",{staticStyle:{"text-align":"center"}},[t("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.submit}},[e._v("保存发票信息")]),t("Button",{attrs:{type:"default"},on:{click:function(t){e.invoiceAvailable=!1}}},[e._v("取消")])],1)],1)])],1)},r=[],d=s("2166"),n=s("7dfd"),c={name:"invoiceModal",data(){return{invoice:1,invoiceAvailable:!1,loading:!1,invoiceForm:{receiptTitle:"",taxpayerId:"",receiptContent:"商品明细"},type:1,ruleInline:{taxpayerId:[{required:!0,message:"请填写纳税人识别号"},{pattern:n["TINumber"],message:"请填写正确的纳税人识别号"}]}}},props:["invoiceData"],watch:{invoiceData:{handler(e){this.invoiceForm={...e},e.taxpayerId?this.type=2:this.type=1},deep:!0,immeadite:!0}},methods:{changeInvoice(e){this.$nextTick(()=>{this.type=e})},save(){let e=!0;const{receiptTitle:t}=JSON.parse(JSON.stringify(this.invoiceForm));return t?(2===this.type?this.$refs.form.validate(t=>{t||(e=!1)}):delete this.invoiceForm.taxpayerId,e):(this.$Message.error("请填写发票抬头!"),e=!1,!1)},async submit(){if(this.save()){this.loading=!0;let e={way:this.$route.query.way,...this.invoiceForm},t=await Object(d["i"])(e);t.success&&this.$emit("change",!0),this.loading=!1}}}},l=c,u=(s("99cd"),s("2877")),p=Object(u["a"])(l,o,r,!1,null,"dced94bc",null),h=p.exports,m=function(){var e=this,t=e._self._c;return t("div",[t("Modal",{attrs:{width:"800",title:"收件人地址"},model:{value:e.showAddr,callback:function(t){e.showAddr=t},expression:"showAddr"}},[t("Form",{ref:"form",attrs:{model:e.formData,"label-position":"left","label-width":100,rules:e.ruleInline}},[t("FormItem",{attrs:{label:"收件人",prop:"name"}},[t("i-input",{staticStyle:{width:"600px"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),t("FormItem",{attrs:{label:"收件地区",prop:"address"}},[e._v(" "+e._s(e.formData.address||"暂无地址")+" "),t("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$refs.map.open()}}},[e._v("选择")])],1),t("FormItem",{attrs:{label:"详细地址",prop:"detail"}},[t("i-input",{staticStyle:{width:"600px"},model:{value:e.formData.detail,callback:function(t){e.$set(e.formData,"detail",t)},expression:"formData.detail"}})],1),t("FormItem",{attrs:{label:"手机号码",prop:"mobile"}},[t("i-input",{staticStyle:{width:"600px"},model:{value:e.formData.mobile,callback:function(t){e.$set(e.formData,"mobile",t)},expression:"formData.mobile"}})],1),t("FormItem",{attrs:{label:"地址别名"}},[t("i-input",{staticStyle:{width:"600px"},attrs:{length:"",maxlength:4,placeholder:"请输入地址别名，例如公司"},model:{value:e.formData.alias,callback:function(t){e.$set(e.formData,"alias",t)},expression:"formData.alias"}})],1),t("FormItem",{attrs:{label:"默认地址"}},[t("i-switch",{model:{value:e.formData.isDefault,callback:function(t){e.$set(e.formData,"isDefault",t)},expression:"formData.isDefault"}})],1)],1),t("div",{staticClass:"mt_20",attrs:{slot:"footer"},slot:"footer"},[t("Button",{on:{click:e.hide}},[e._v("取消")]),t("Button",{staticClass:"mr_10",attrs:{type:"primary",loading:e.loading},on:{click:e.save}},[e._v("保存收货地址")])],1)],1),t("multipleMap",{ref:"map",on:{callback:e.getAddress}})],1)},v=[],f=s("a5d4"),g=s("2f94"),_={name:"addressManage",props:{id:{defalut:"",type:String}},data(){return{showAddr:!1,formData:{isDefault:!1},ruleInline:{name:[{required:!0,message:"请输入收件人姓名",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"change"}],detail:[{required:!0,message:"请输入详细地址",trigger:"blur"}],mobile:[{required:!0,message:"手机号不能为空",trigger:"blur"},{type:"string",pattern:/^1[3|4|5|6|7|8][0-9]{9}$/,message:"手机号格式出错",trigger:"blur"}]},loading:!1,mapMsg:{}}},methods:{save(){this.$refs.form.validate(e=>{if(e){const e=JSON.parse(JSON.stringify(this.formData));e.consigneeAddressPath=e.address.replace(/\s/g,","),delete e.address,this.loading=!0,this.id?Object(g["b"])(e).then(e=>{this.loading=!1,e.success&&(this.$Message.success("编辑地址成功"),this.$emit("change",!0),this.hide())}).catch(()=>{this.loading=!1}):Object(g["f"])(e).then(e=>{this.loading=!1,e.success&&(this.$Message.success("新增地址成功"),this.$emit("change",!0),this.hide())}).catch(()=>{this.loading=!1})}})},getAddrById(e){Object(g["c"])(e).then(e=>{if(e.success){console.log(e);const t=e.result;t.address=e.result.consigneeAddressPath.replace(/,/g," "),this.formData=t}})},getAddress(e){if("select"===e.type){const t=e.data.map(e=>e.name).join(","),s=e.data.map(e=>e.id).join(",");this.$set(this.formData,"address",t),this.$set(this.formData,"consigneeAddressIdPath",s);const i=e.data[e.data.length-1].center.split(",");this.formData.lat=i[1],this.formData.lon=i[0]}else this.$set(this.formData,"address",e.data.addr),this.$set(this.formData,"consigneeAddressIdPath",e.data.addrId),this.$set(this.formData,"detail",e.data.address),this.formData.lat=e.data.position.lat,this.formData.lon=e.data.position.lng},show(){this.showAddr=!0},hide(){this.showAddr=!1}},watch:{id:{handler:function(e){e?this.getAddrById(e):(this.formData={isDefault:!1},this.$refs.form.resetFields())}}},components:{multipleMap:f["a"]}},b=_,y=(s("723a"),Object(u["a"])(b,m,v,!1,null,"4c48c80a",null)),C=y.exports,k=s("84a9"),w=s("8194"),I={name:"Pay",components:{invoiceModal:h,addressManage:C},data(){return{selectedStoreAddress:"m",selectMethod:"",stepIndex:1,invoiceAvailable:!1,showEditBtn:"",orderMark:"",goodsType:"",storeMoreAddr:!1,invoiceData:{receiptTitle:"个人",receiptContent:"不开发票"},searchForm:{pageNumber:1,pageSize:100},shippingMethod:[],storeAddressList:[],shippingWay:[{value:"LOGISTICS",label:"物流"},{value:"SELF_PICK_UP",label:"自提"}],selectedDeliverMethod:"LOGISTICS",addressList:[],selectedAddress:{},goodsList:[],priceDetailDTO:{},totalNum:0,addrId:"",moreAddr:!1,canUseCouponNum:0,couponList:[],usedCouponId:[],selectedCoupon:{},storeId:""}},mounted(){this.init()},methods:{init(){this.getGoodsDetail(),this.getDistribution()},goAddressManage(){this.$router.push("/home/MyAddress")},getAddress(){Object(g["e"])(this.searchForm).then(e=>{e.success&&(this.addressList=e.result.records,this.addressList.forEach((e,t)=>{e.id===this.selectedAddress.id&&t>2&&(this.moreAddr=!0)}))})},async getDistribution(){let e,t=await Object(d["r"])({way:this.$route.query.way});if(t.success){e=t.result;let s=[];console.log(e),this.shippingWay.forEach(t=>{e.forEach(e=>{t.value==e&&s.push(t)})}),this.shippingMethod=s,console.log(this.shippingMethod)}},async getStoreAddressList(){Object(k["h"])(this.storeId,this.searchForm).then(e=>{e.success&&(this.storeAddressList=e.result.records,this.storeAddressList.forEach((e,t)=>{e.id===this.selectedAddress.id&&t>2&&(this.storeMoreAddr=!0)}))})},getGoodsDetail(){this.$Spin.show(),Object(d["d"])({way:this.$route.query.way}).then(e=>{if(this.$Spin.hide(),e.success){e.result.checkedSkuList&&0!==e.result.checkedSkuList.length||(e.result.skuList&&e.result.skuList[0]&&this.$Modal.warning({title:"购物车存在无效商品！",content:"["+e.result.skuList[0].goodsSku.goodsName+"]"+e.result.skuList[0].errorMessage}),this.$router.push({path:"/cart",replace:!0})),this.goodsList=e.result.cartList,this.priceDetailDTO=e.result.priceDetailDTO,this.skuList=e.result.skuList,e.result.skuList[0]&&e.result.skuList[0].goodsSku&&(this.goodsType=e.result.skuList[0].goodsSku.goodsType),this.storeId=this.goodsList[0].storeId,e.result.receiptVO&&(this.invoiceData=e.result.receiptVO);let t=e.result.notSupportFreight;if(this.selectedCoupon={},e.result.platformCoupon&&(this.selectedCoupon[e.result.platformCoupon.memberCoupon.id]=e.result.platformCoupon),e.result.storeCoupons&&Object.keys(e.result.storeCoupons)[0]){let t=Object.keys(e.result.storeCoupons)[0],s=e.result.storeCoupons[t].memberCoupon.id;this.selectedCoupon[s]=e.result.storeCoupons[t]}if(t){let e=[],s="";t.forEach(t=>{s=t.errorMessage,e.push(t.goodsSku.goodsName)}),this.$Modal.warning({title:"以下商品超出配送区域",content:e.toString()})}e.result.memberAddress&&(this.selectedAddress=e.result.memberAddress),this.getAddress(),this.getStoreAddressList(),this.totalNum=0;for(let e=0;e<this.skuList.length;e++)this.totalNum+=this.skuList[e].num;this.usedCouponId=[],this.couponList=e.result.canUseCoupons;const s=Object.keys(this.selectedCoupon);s.length&&(this.couponList.forEach(e=>{this.selectedCoupon[e.id]&&e.id===this.selectedCoupon[e.id].memberCoupon.id&&this.usedCouponId.push(e.id)}),this.$nextTick(()=>{this.$forceUpdate()}))}}).catch(()=>{this.$Spin.hide()})},getCouponNum(){Object(d["f"])({way:this.$route.query.way}).then(e=>{if(this.canUseCouponNum=e.result,e.result){let e=[],t=[];this.goodsList.forEach(s=>{e.push(s.storeId),s.skuList.forEach(e=>{t.push(e.goodsSku.id)})});let s={pageNumber:1,pageSize:100,memberCouponStatus:"NEW",scopeId:t.toString(),storeId:e.toString(),totalPrice:this.priceDetailDTO.goodsPrice};Object(w["i"])(s).then(e=>{e.success&&(this.couponList=e.result.records);const t=Object.keys(this.selectedCoupon);this.usedCouponId=[],t.length&&(this.couponList.forEach(e=>{e.id===this.selectedCoupon[t].memberCoupon.id&&this.usedCouponId.push(e.id)}),this.$nextTick(()=>{this.$forceUpdate()}))})}})},selectAddress(e){let t={way:this.$route.query.way,shippingAddressId:e.id};Object(d["j"])(t).then(t=>{t.success&&(this.$Message.success("选择配送方式成功"),this.selectMethod=e,this.getGoodsDetail())})},selectStoreAddress(e){console.log(e.id),console.log(this.$route.query.way),Object(d["q"])(e.id,this.$route.query.way).then(t=>{t.success&&(this.$Message.success("选择自提地址成功"),this.selectedStoreAddress=e,this.getGoodsDetail())})},selectDeliverMethod(e){let t={way:this.$route.query.way,shippingMethod:e.value};Object(d["p"])(t).then(t=>{t.success&&(this.selectedDeliverMethod=e.value,this.getGoodsDetail())})},editAddress(e){this.addrId=e,this.$refs.address.show()},addrChange(){this.getAddress()},delAddress(e){this.$Modal.confirm({title:"提示",content:"你确定删除这个收货地址",onOk:()=>{Object(g["a"])(e.id).then(e=>{e.success&&(this.$Message.success("删除成功"),this.getAddress())})},onCancel:()=>{}})},goGoodsDetail(e,t){let s=this.$router.resolve({path:"/goodsDetail",query:{skuId:e,goodsId:t}});window.open(s.href,"_blank")},goShopPage(e){let t=this.$router.resolve({path:"/Merchant",query:{id:e}});window.open(t.href,"_blank")},useCoupon(e,t){let s={way:this.$route.query.way,memberCouponId:e,used:t};Object(d["k"])(s).then(e=>{e.success&&this.init()})},editInvoice(){this.$refs.invModal.invoiceAvailable=!0},getInvMsg(e){e&&(this.init(),this.$refs.invModal.invoiceAvailable=!1)},pay(){const e={client:"PC",remark:[],way:this.$route.query.way};this.goodsList.forEach(t=>{t.remark&&e.remark.push({remark:t.remark,storeId:t.storeId})}),e.remark.length||delete e.remark,this.$Spin.show(),Object(d["g"])(e).then(t=>{this.$Spin.hide(),t.success&&("POINTS"===e.way?this.$router.push("/payDone"):this.$router.push({path:"/payment",query:{orderType:"TRADE",sn:t.result.sn}}))}).catch(()=>{this.$Spin.hide()})},useScope(e){let t="全部商品";switch(e){case"ALL":t="全部商品";break;case"PORTION_GOODS":t="部分商品";break;case"PORTION_GOODS_CATEGORY":t="部分分类商品";break}return t+"可用"}}},D=I,A=(s("c7c6"),Object(u["a"])(D,i,a,!1,null,"6d0ca61c",null));t["default"]=A.exports},c7c6:function(e,t,s){"use strict";s("847c")},e092:function(e,t,s){e.exports=s.p+"static/img/geted.3f84cfb6.png"}}]);